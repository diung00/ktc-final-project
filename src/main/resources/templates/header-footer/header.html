<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<link rel="stylesheet" href="/static/css/header-footer/header.css">
<header>
    <!-- ë¶€íŠ¸ ìŠ¤íŠ¸ë© ì„¸íŒ…ë„ on -->
    <div class="nav-bar">
        <a href="/views" class="logo">ChoiGangDelivery</a>
        <!-- ë‚˜ì¤‘ì— ë¡œê³ ì— ì•„ì´ì½˜ ë§í¬ì‹œí‚¤ê¸° -->
<!--        <ul class="nav-menu">-->
<!--            <li><a href="/restaurants">Restaurants</a></li>-->
<!--            <li><a href="/foods">ë§›ì§‘</a></li>-->
<!--            &lt;!&ndash; ì¶”ê°€ ë©”ë‰´ í•­ëª© &ndash;&gt;-->
<!--        </ul>-->

        <div class="nav-user-info" id="navUserInfo">
            <span id="username"></span>
            <span id="role"></span>
            <!--            &lt;!&ndash; ì‚¬ìš©ì ì´ë¦„, ë¡œê·¸ì¸ ìƒíƒœ, ì¥ë°”êµ¬ë‹ˆ ë“±ì˜ ì•„ì´ì½˜ &ndash;&gt;-->
            <!--            &lt;!&ndash; ì‚¬ìš©ì ì´ë¦„ &ndash;&gt;-->
            <!--            <span class="nickname">ì‚¬ìš©ìëª…</span>-->
            <!--            &lt;!&ndash; ì‚¬ìš©ì ìƒíƒœ &ndash;&gt;-->
            <!--            &lt;!&ndash; íšŒì› // í˜¸í…” ë§¤ë‹ˆì € // ê´€ë¦¬ìì—ë”°ë¼ ë‹¤ë¥´ê²Œ ë³´ì—¬ì£¼ê¸° &ndash;&gt;-->
            <!--            <span class="user-role">íšŒì›</span>-->
            <!--            &lt;!&ndash; ì•„ì´ì½˜ ì˜ˆì‹œ &ndash;&gt;-->
            <!--            <a href="/cart"><i class="cart-icon">ğŸ›’</i></a>-->
            <!--            <a href="/my-page"><i class="profile-icon">ğŸ‘¤</i></a>-->
            <!-- ... -->
        </div>
    </div>
</header>
<script>
    const jwt = localStorage.getItem("token");
    const navUserInfoDiv = document.getElementById('navUserInfo');
    if (!jwt) {
        const loginHref = document.createElement('a');
        loginHref.href = '/views/login';
        loginHref.innerText = 'ë¡œê·¸ì¸';
        loginHref.classList.add('text-menu');
        navUserInfoDiv.appendChild(loginHref);
    }
    async function fetchLoginInfo() {
        
        const response = await fetch('/users/get-my-profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${jwt}`
            }
        });
       

        if (response.ok) {
            const data = await response.json();

            const usernameHref = document.createElement('a');
            usernameHref.href = '/views/get-my-profile';
            usernameHref.style.textDecoration = 'none';
            usernameHref.style.color = 'black';
            usernameHref.innerHTML = `<span style="color: white;">Welcome to </span><span class="username" style="margin-right: 8px;"> ${data.username} ğŸ§‘â€ğŸ³`;

            const userRoleSpan = document.createElement('span');
            userRoleSpan.classList.add('user-role');

            let role = '';
            let additionalHref = null;
            if (data.role === 'ROLE_USER') {
                role = ' íšŒì›';
                const userHref = document.createElement('a');
                userHref.href = '/views/my-order';
                userHref.innerHTML = `ğŸ›’ My Order`;
                userHref.classList.add('text-menu');
                additionalHref = userHref;
            }
            else if (data.role === 'ROLE_DRIVER') {
                role = ' ë°°ë‹¬ì›';
                const managementHref = document.createElement('a');
                managementHref.href = '/views/driver';
                managementHref.innerText = ' ë°°ë‹¬ ëŒ€ì‹œë³´ë“œ';
                managementHref.classList.add('text-menu');
                additionalHref = managementHref;
            }
            else if (data.role === 'ROLE_OWNER') {
                role = ' ë§¤ë‹ˆì €';
                const managementHref = document.createElement('a');
                managementHref.href = '/views/restaurant-management';
                managementHref.innerText = ' ì‹ë‹¹ ê´€ë¦¬';
                managementHref.classList.add('text-menu');
                additionalHref = managementHref;
            }
            else if (data.role === 'ROLE_ADMIN') {
                role = ' ê´€ë¦¬ì';
                const dashboardHref = document.createElement('a');
                dashboardHref.href = '/views/admin';
                dashboardHref.innerText = 'ëŒ€ì‹œë³´ë“œ';
                dashboardHref.classList.add('text-menu');
                additionalHref = dashboardHref;
            }
            userRoleSpan.innerText = role;

            const logoutHref = document.createElement('a');
            logoutHref.href = '#';
            logoutHref.innerText = 'ë¡œê·¸ì•„ì›ƒ';
            logoutHref.classList.add('text-menu');
            logoutHref.addEventListener('click', logout);

            navUserInfoDiv.appendChild(usernameHref);
            navUserInfoDiv.appendChild(userRoleSpan);
            if (additionalHref != null) navUserInfoDiv.appendChild(additionalHref);
            navUserInfoDiv.appendChild(logoutHref);
        } else {
            const loginHref = document.createElement('a');
            loginHref.href = '/views/login';
            loginHref.innerText = 'ë¡œê·¸ì¸';
            loginHref.classList.add('text-menu');
            navUserInfoDiv.appendChild(loginHref);
        }
    } 

    function logout() {
        localStorage.removeItem("token");
        location.href = "/views";
    }

    function initialize() {
        fetchLoginInfo();
    }

    initialize();
</script>
</html>