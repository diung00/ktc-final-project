<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<link rel="stylesheet" href="/static/css/header-footer/header.css">
<header>
    <!-- Î∂ÄÌä∏ Ïä§Ìä∏Îû© ÏÑ∏ÌåÖÎèÑ on -->
    <div class="nav-bar">
        <a href="/views" class="logo">ChoiGangDelivery</a>
        <!-- ÎÇòÏ§ëÏóê Î°úÍ≥†Ïóê ÏïÑÏù¥ÏΩò ÎßÅÌÅ¨ÏãúÌÇ§Í∏∞ -->
<!--        <ul class="nav-menu">-->
<!--            <li><a href="/restaurants">Restaurants</a></li>-->
<!--            <li><a href="/foods">ÎßõÏßë</a></li>-->
<!--            &lt;!&ndash; Ï∂îÍ∞Ä Î©îÎâ¥ Ìï≠Î™© &ndash;&gt;-->
<!--        </ul>-->

        <div class="nav-user-info" id="navUserInfo">
            <span id="username"></span>
            <span id="role"></span>
            <!--            &lt;!&ndash; ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ, Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú, Ïû•Î∞îÍµ¨Îãà Îì±Ïùò ÏïÑÏù¥ÏΩò &ndash;&gt;-->
            <!--            &lt;!&ndash; ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ &ndash;&gt;-->
            <!--            <span class="nickname">ÏÇ¨Ïö©ÏûêÎ™Ö</span>-->
            <!--            &lt;!&ndash; ÏÇ¨Ïö©Ïûê ÏÉÅÌÉú &ndash;&gt;-->
            <!--            &lt;!&ndash; ÌöåÏõê // Ìò∏ÌÖî Îß§ÎãàÏ†Ä // Í¥ÄÎ¶¨ÏûêÏóêÎî∞Îùº Îã§Î•¥Í≤å Î≥¥Ïó¨Ï£ºÍ∏∞ &ndash;&gt;-->
            <!--            <span class="user-role">ÌöåÏõê</span>-->
            <!--            &lt;!&ndash; ÏïÑÏù¥ÏΩò ÏòàÏãú &ndash;&gt;-->
            <!--            <a href="/cart"><i class="cart-icon">üõí</i></a>-->
            <!--            <a href="/my-page"><i class="profile-icon">üë§</i></a>-->
            <!-- ... -->
        </div>
    </div>
</header>
<script>
     const jwt = localStorage.getItem("token");
    if (!jwt) {
        location.href = "/views/login";
    }

    async function fetchLoginInfo() {
        const navUserInfoDiv = document.getElementById('navUserInfo');
        
        const response = await fetch('/users/get-my-profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${jwt}`
            }
        });
       

        if (response.ok) {
            const data = await response.json();

            const usernameHref = document.createElement('a');
            usernameHref.href = '/views/get-my-profile';
            usernameHref.style.textDecoration = 'none';
            usernameHref.style.color = 'black';
            usernameHref.innerHTML = `<span class="username" style="margin-right: 8px;"> ${data.username} </span>`;

            const userRoleSpan = document.createElement('span');
            userRoleSpan.classList.add('user-role');

            let role = '';
            let additionalHref = null;
            if (data.role === 'ROLE_USER') {
                role = ' ÌöåÏõê';
                const userHref = document.createElement('a');
                userHref.href = '/views/my-order';
                userHref.innerHTML = `üõí My Order`;
                userHref.classList.add('text-menu');
                additionalHref = userHref;
            }
            else if (data.role === 'ROLE_DRIVER') {
                role = ' Î∞∞Îã¨Ïõê';
                const managementHref = document.createElement('a');
                managementHref.href = '/views/driver';
                managementHref.innerText = ' Î∞∞Îã¨ ÎåÄÏãúÎ≥¥Îìú';
                managementHref.classList.add('text-menu');
                additionalHref = managementHref;
            }
            else if (data.role === 'ROLE_OWNER') {
                role = ' Îß§ÎãàÏ†Ä';
                const managementHref = document.createElement('a');
                managementHref.href = '/views/restaurant-management';
                managementHref.innerText = ' ÏãùÎãπ Í¥ÄÎ¶¨';
                managementHref.classList.add('text-menu');
                additionalHref = managementHref;
            }
            else if (data.role === 'ROLE_ADMIN') {
                role = ' Í¥ÄÎ¶¨Ïûê';
                const dashboardHref = document.createElement('a');
                dashboardHref.href = '/views/admin';
                dashboardHref.innerText = 'ÎåÄÏãúÎ≥¥Îìú';
                dashboardHref.classList.add('text-menu');
                additionalHref = dashboardHref;
            }
            userRoleSpan.innerText = role;

            const logoutHref = document.createElement('a');
            logoutHref.href = '#';
            logoutHref.innerText = 'Î°úÍ∑∏ÏïÑÏõÉ';
            logoutHref.classList.add('text-menu');
            logoutHref.addEventListener('click', logout);

            navUserInfoDiv.appendChild(usernameHref);
            navUserInfoDiv.appendChild(userRoleSpan);
            if (additionalHref != null) navUserInfoDiv.appendChild(additionalHref);
            navUserInfoDiv.appendChild(logoutHref);
        } else {
            const loginHref = document.createElement('a');
            loginHref.href = '/views/login';
            loginHref.innerText = 'Î°úÍ∑∏Ïù∏';
            loginHref.classList.add('text-menu');
            navUserInfoDiv.appendChild(loginHref);
        }

        // // Í∞ÄÎ°ú ÎßàÏßÑ Í∞íÏùÑ ÏÑ§Ï†ïÌï† Î≥ÄÏàò
        // const horizontalMarginValue = '3px';
        //
        // // ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îêú ÏöîÏÜåÎì§ÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.
        // const dynamicElements = document.querySelectorAll('.nav-user-info > *');
        //
        // // Í∞Å ÏöîÏÜåÏóê Í∞ÄÎ°ú ÎßàÏßÑÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.
        // dynamicElements.forEach(element => {
        //     element.style.marginLeft = horizontalMarginValue;
        //     element.style.marginRight = horizontalMarginValue;
        // });
    }

    function logout() {
        localStorage.removeItem("token");
        location.href = "/views/login";
    }

    function initialize() {
        fetchLoginInfo();
    }

    initialize();
</script>
</html>